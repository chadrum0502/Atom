%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%　報告会資料用フォーマットVersion2.00
%　date:2006.6.17
%　作成者：山田　洋明
%  Ver2.00 (2006/6/17) styファイルの統一
%  Ver1.87 (2005/8/7) ieej.clsの使用（参考文献部分のコメントアウト）
%  Ver1.86（2005/5/2）報告会区分を廃止
%  Ver1.85（2005/1/28）不等号を追加！
%  Ver1.84（2004/12/20）subfigureを使用可能にしました。
%　Ver1.82 (2004/5/18) 報告会資料名を選択可能に。
%　Ver1.81 (2004/5/9) 資料名を入力項目に追加
%　Ver1.8 (2004/4/27) 図の配置を緩やかに！
%　Ver1.71（2003/11/28）数式中のベクトル表記用マクロを追加
%　Ver1.7(2003/11/18)　出力時に右に書面がずれないように修正
%　　　　　報告日・資料番号の左側の位置が揃うように改善
%　Ver1.6(2003/11/5)　タイトル等の書式をスタイルファイルへ
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  フォーマットVersion2.00 (2006.6.17)

\typeout{電気エネルギー制御研究室(Epc-Lab)}
\typeout{報告会資料作成用スタイルファイルVersion 2.00(2006/6/17作成)}
\typeout{作成者：山田 洋明}


%%%%%houkokukai.sty%%%%%
%　上の余白＝1inch＋\hoffset＋\topmargin＋\headheight＋\headsep
%　左の余白＝1inch＋\voffset＋\oddsidemargin (\evensidemargin)
%　下の余白＝\paperheight−上の余白−\textheight
%　右の余白＝\paperwidth−左の余白−\textwidth


\setlength{\topmargin}{0truemm}
% \setlength{\headheight}{3.5cm}
% \setlength{\headsep}{0.3cm}

% \setlength{\topskip}{1cm}
% \setlength{\columnwidth}{12.5cm}
% \setlength{\columnsep}{1cm}
% \setlength{\unitlength}{3mm}


%% 高さの設定 1inch=25.4mm
\setlength{\textheight}{\paperheight}   % ひとまず紙面を本文領域に
\setlength{\topmargin}{9.6truemm}      % 上の余白35mm(=1inch+9.6mm)に
\addtolength{\topmargin}{-\headheight}
\addtolength{\topmargin}{-\headsep}     % ヘッダの分だけ本文領域を移動させる
\addtolength{\textheight}{-60truemm}    % 下の余白30mmに

%% 幅の設定
\setlength{\textwidth}{\paperwidth}     % ひとまず紙面を本文領域に
\setlength{\oddsidemargin}{4.6truemm}  % 左の余白を30mm(=1inch+4.6mm)に
\setlength{\evensidemargin}{4.6truemm} % 
\addtolength{\textwidth}{-60truemm}


%　図の配置制御（田中先生から）
\renewcommand{\topfraction}{0.95}
\renewcommand{\bottomfraction}{0.7}
\renewcommand{\textfraction}{0.2}
\renewcommand{\floatpagefraction}{0.5}
\renewcommand{\dbltopfraction}{0.7}
\renewcommand{\dblfloatpagefraction}{0.5}

%　subfigure.styに下記を反映（下記を調整してもdvioutには反映されません）
%\renewcommand{\subfigbottomskip}{10pt}%図の下の隙間。副題と本題の間。
%\renewcommand{\subfigtopskip}{0mm}%図と図の間
%\renewcommand{\subfigcapskip}{-2mm}%図と副題の間
%\renewcommand{\subcapsize}{\scriptsize}

%%%%%章（始）%%%%
% \renewcommand{\section}{\@startsection{section}{1}{.1zw}%
%   {.00001\Cvs \@plus.2\Cdp \@minus.1\Cdp}%
%   {.00001\Cvs \@plus.1\Cdp \@minus.1\Cdp}%
%   {\reset@font\normalsize\bfseries}}%
% \renewcommand{\subsection}{\@startsection{subsection}{1}{.1zw}%
%   {.00001\Cvs \@plus.2\Cdp \@minus.1\Cdp}%
%   {.00001\Cvs \@plus.1\Cdp \@minus.1\Cdp}%
%   {\reset@font\normalsize\bfseries}}%
% \renewcommand{\subsubsection}{\@startsection{subsubsection}{1}{.1zw}%
%   {.00001\Cvs \@plus.2\Cdp \@minus.1\Cdp}%
%   {.00001\Cvs \@plus.1\Cdp \@minus.1\Cdp}%
%   {\reset@font\normalsize\bfseries}}%
% \setcounter{section}{0}
% \setcounter{subsection}{0}
% \setcounter{subsubsection}{0}
%%%%%章（終）%%%%

%%%%%図・表（始）%%%%
\def\fnum@figure{図 \thefigure \hspace{2mm}}
\def\fnum@table{表 \thetable \hspace{2mm}}
\long\def\@makecaption#1#2{
 \vskip 2pt 
 \setbox\@tempboxa\hbox{#1 #2}
 \ifdim \wd\@tempboxa >\hsize \unhbox\@tempboxa\par \else \hbox
to\hsize{\hfil\box\@tempboxa\hfil}
 \fi}
%%%%%図・表（終）%%%%

%%%%%Vector（始）%%%%
\def\Vec#1{\mbox{\boldmath $#1$}}
%%%%%Vector（終）%%%%

%%%%%不等号（始）%%%%
\def\Leq#1#2{#1 \stackrel{\displaystyle <}{\raisebox{-0.75ex}{\small{=}}}#2}
\def\Geq#1#2{#1 \stackrel{\displaystyle >}{\raisebox{-0.75ex}{\small{=}}}#2}
%%%%%不等号（終）%%%%

%%%%%参考文献（始）%%%%
%\def\refname{\centering \normalsize 参考文献 \\ \vspace{-3.5mm} \hrulefill}
%\def\@biblabel#1{(#1)}
%\def\cite{\@ifnextchar [{\@tempswatrue\@citex}{\@tempswafalse\@citex[]}}
%\def\@citex[#1]#2{\if@filesw\immediate\write\@auxout{\string\citation{#2}}\fi
%  \def\@citea{}\@cite{\@for\@citeb:=#2\do
%    {\@citea\def\@citea{,\penalty\@m\ }
%	\@ifundefined{b@\@citeb}{{\bf ??}
%	  \@warning{Citation `\@citeb' on page \thepage \space undefined}}
%{\csname b@\@citeb\endcsname}}}{#1}}
%\def\@cite#1#2{$^{(#1\if@tempswa $\sim$#2\fi)}$}
%%%%%参考文献（終）%%%%


%　参考文献定義用スタイルファイル
%　
%　2004/1/9　Syuuron.styより分割・修正
%　Version1.0

\def\@cite#1#2{\leavevmode\unskip
  \ifnum\lastpenalty=\z@\penalty\@highpenalty\fi% highpenalty before
  \,$^{\mbox{\tiny ({\multiply\@highpenalty 3 #1% % triple-highpenalties within
      \if@tempswa,\penalty\@highpenalty\ #2\fi % and before note.
    })}}$\spacefactor\@m}

\def\Cite{\@ifnextchar [{\@tempswatrue\@Citex}{\@tempswafalse\@Citex[]}}
\def\@Citex[#1]#2{\if@filesw\immediate\write\@auxout{\string\citation{#2}}\fi
  \def\@citea{}\@Cite{\@for\@citeb:=#2\do
    {\@citea\def\@citea{\sim\penalty\@m\ }
	\@ifundefined{b@\@citeb}{{\bf ??}
	  \@warning{Citation `\@citeb' on page \thepage \space undefined}}
{\csname b@\@citeb\endcsname}}}{#1}}
\def\@Cite#1#2{{$(#1\if@tempswa #2\fi)$}}




%%%%% mathchm2.sty %%%%%
%% 
%% This is file `mathchm2.sty', generated 
%% on <1996/8/12> with the docstrip utility (2.2i).
%% 
%% The original source files were:
%% 
%% mathchm2.dtx  (with options: `mathchm2')
%% 
%% This is a generated file. 
%% 
%% Copyright 1996 by Shinsaku Fujita 
%% 
%% This file is part of ``mathchm2''. 
%% ================================== 
%% 
%% Released on August 30, 1996 
%% 
%% Copyright (C) 1996 by Shinsaku Fujita, all rights reserved. 
%% This style file is created for submitting a manuscript to 
%% scientific journals. 
%% 
%% Copying of this file is authorized only if either 
%% 
%% (1) you make absolutely no changes to your copy, including name and 
%% directory name 
%% (2) if you do make changes, 
%% (a) you name it something other than the names included in the 
%% ``chemist'' directory and 
%% (b) you acknowledge the original name. 
%% This restriction ensures that all standard styles are identical. 
%% 
%% ======================================= 
%% 
%% This file contains codes modified from latex.tex (LaTeX2.09) and of 
%% latex.ltx (a LaTeX2e), where the reused parts are subject to 
%% Copyright 1994 the LaTeX3 project and the individual authors 
%% (For further copyright information see the file legal.txt of 
%% the LaTeX2e standard distribution, and any other copyright 
%% indicated in this file.) 
%% 
%% \CharacterTable
%%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%%   Digits        \0\1\2\3\4\5\6\7\8\9
%%   Exclamation   \!     Double quote  \"     Hash (number) \#
%%   Dollar        \$     Percent       \%     Ampersand     \&
%%   Acute accent  \'     Left paren    \(     Right paren   \)
%%   Asterisk      \*     Plus          \+     Comma         \,
%%   Minus         \-     Point         \.     Solidus       \/
%%   Colon         \:     Semicolon     \;     Less than     \<
%%   Equals        \=     Greater than  \>     Question mark \?
%%   Commercial at \@     Left bracket  \[     Backslash     \\
%%   Right bracket \]     Circumflex    \^     Underscore    \_
%%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%%   Right brace   \}     Tilde         \~}
%%
%% `mathchm2.dtx' ver3.01 (for LaTeX2e) 1996/08/30
%%  by Shinsaku Fujita
%%
\@ifundefined{NeedsTeXFormat}{}
{\NeedsTeXFormat{LaTeX2e}}
\@ifundefined{ProvidesFile}{}{\ProvidesFile{mathchm2.sty}
         [1996/08/30 v3.01
     mathchm2 package ]}
\def\j@urnalname{mathchm2} \def\journalID{mathchm2}
\def\versi@ndate{August 30, 1996}
\def\versi@nno{ver3.01}
\def\copyrighth@lder{SF} % Shinsaku Fujita
\typeout{Package `\j@urnalname' (\versi@nno) <\versi@ndate>\space
[\copyrighth@lder]}
\typeout{[Macros for grouping equations with %
 individual sequential numbers]}
\typeout{[for LaTeX2.09 and LaTeX2e]}
\def\dotfillelement{$\m@th\mkern1.5mu\cdot\mkern1.5mu$}
\def\dotfilleqn{\if@eqnsw\leaders%
  \hbox{\dotfillelement}\hfill\else\hfil\fi}
\newif\if@doteqn \@doteqnfalse
\newif\if@oldeqsw \@oldeqswtrue%1995/10/15 by S. Fujita
\def\doteqnoff{\let\dotorspace=\hfil%
 \let\eqnSpan=& \relax\@doteqnfalse%
 \@oldeqswtrue}%1995/10/15 by S. Fujita
\doteqnoff%default setting
\def\doteqnon{\let\dotorspace=\dotfilleqn%
 \let\eqnSpan=\span\@doteqntrue%
 \@oldeqswfalse}%1995/10/15 by S. Fujita
\def\eqrelstretch{0.41667}%ca. 5/12
\def\eqnostretch{0.5}
\def\eqleftstretch{1}
\newif\if@eqnflush \@eqnflushfalse
\def\eqnflushon{\@eqnflushtrue}
\def\eqnflushoff{\@eqnflushfalse}
\def\eqnosep{0}
\def\@eqnnum{(\theequation)\kern\eqnosep\parindent}
\newcount\EQ@cnt%added by SF for version 2.02(1995/10/27)
\@ifundefined{p@renwd}{\newdimen\p@renwd \p@renwd=8.75\p@}{}
\def\equAtion{\stepcounter{equation}\let\@currentlabel=\theequation
\w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
\setbox0=\hbox{\@eqnnum}\dimen1=\wd0
\advance\dimen1 by\eqnostretch\arraycolsep
\global\@eqnswtrue\tabskip\@centering
$$\halign to \displaywidth\bgroup\hskip\@centering
\if@oldeqsw\else%%%%%%%%%%%1995/10/15 for ver2.01
 \hskip\eqnostretch\arraycolsep%
 \hskip\dimen1
\fi%%%%%%%%%%%%%%%%
$\displaystyle\tabskip\z@{##}$%
\if@oldeqsw\else%%%%%%%%%%%1995/10/15 for ver2.01
  \hskip\eqnostretch\arraycolsep%
\fi%%%%%%%%%%%%%%%%
  \dotorspace
\if@oldeqsw\else%%%%%%%%%%%1995/10/15 for ver2.01
  \hskip\dimen1
\fi%%%%%%%%%%%%%%%%
  \tabskip\@centering
  &\llap{##}\tabskip\z@\cr
  \mathstrut&\cr\noalign{\vskip-\baselineskip}}
\def\endequAtion{\eqnSpan%
 \if@eqnsw\@eqnnum\stepcounter{equation}\fi%
 \global\@eqnswtrue\cr\egroup
 \global\advance\c@equation\m@ne$$\global\@ignoretrue}
\let\@seqncr=\@eqncr
\@namedef{equAtion*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\equAtion}
\@namedef{endequAtion*}{\nonumber\endequAtion\@frameeqnstarfalse}
\def\Equation{\stepcounter{equation}\let\@currentlabel=\theequation
\w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
\setbox0=\hbox{\@eqnnum}\dimen1=\wd0
\advance\dimen1 by\eqnostretch\arraycolsep
\global\@eqnswtrue
$$\dimen0=\displaywidth%
\advance\dimen0-\eqleftstretch\leftmargini%
\rightline\bgroup\noindent$%
\vcenter\bgroup\kern\fboxsep
\halign to \dimen0\bgroup\hskip\@centering
  $\displaystyle\tabskip\z@{##}$
  \hskip\eqnostretch\arraycolsep%
  \dotorspace\hskip\dimen1\tabskip\@centering
   &\llap{##}\tabskip\z@\cr
  \mathstrut&\cr\noalign{\vskip-\baselineskip}}
\def\endEquation{\eqnSpan%
 \if@eqnsw\@eqnnum\stepcounter{equation}\fi%
 \global\@eqnswtrue\cr\egroup
 \global\advance\c@equation\m@ne%
 \egroup$\egroup$$\global\@ignoretrue}
\let\@seqncr=\@eqncr
\@namedef{Equation*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\Equation}
\@namedef{endEquation*}{\nonumber\endEquation\@frameeqnstarfalse}
\def\equation{\if@eqnflush\Equation\else\equAtion\fi}
\def\endequation{\if@eqnflush\endEquation\else\endequAtion\fi}
\@namedef{equation*}{\@oldeqswtrue%1995/10/15 for ver2.01
\def\@eqncr{\nonumber\@seqncr}\equation}
\@namedef{endequation*}{\nonumber\endequation%
 \if@doteqn\@oldeqswfalse\fi}%1995/10/15 for ver2.01
\def\eqnArray{\stepcounter{equation}\let\@currentlabel=\theequation
 \if@eqna \let\@currentlabels=\theequations\fi%
   %added for referring an eqn-group 1996/08/04 by S. Fujita (v3.00a)
\w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
\global\@eqnswtrue
\setbox0=\hbox{\@eqnnum}\dimen1=\wd0
\advance\dimen1 by\eqnostretch\arraycolsep
\global\@eqcnt\z@\tabskip\@centering\let\\=\@eqncr
$$\halign to \displaywidth\bgroup%
\hskip\@centering
\if@oldeqsw\else%%%%%%%%%%%1995/10/15 for ver2.01
 \hskip\eqnostretch\arraycolsep%
 \hskip\dimen1
\fi%%%%%%%%%%%%%%%%
  $\displaystyle\tabskip\z@{##}$\@eqnsel%
  &\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$
\if@oldeqsw\else%%%%%%%%%%%1995/10/15 for ver2.01
  \hskip\eqnostretch\arraycolsep%
\fi%%%%%%%%%%%%%%%
  \dotorspace
\if@oldeqsw\else%%%%%%%%%%%1995/10/15 for ver2.01
  \hskip\dimen1%
\fi%%%%%%%%%%%%%%%%
 \tabskip\@centering
 &\llap{##}\tabskip\z@\cr
 \noalign{\global\EQ@cnt=\@eqcnt}%
  %added by SF for version 2.02(1995/10/27)
 \mathstrut&&&\cr%
 \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endeqnArray{\@@eqncr\egroup
      \global\advance\c@equation\m@ne$$\global\@ignoretrue}
\def\@@eqncr{\let\@tempa\relax
    \ifcase\@eqcnt%
     \def\@tempa{& & \eqnSpan}\or \def\@tempa{& \eqnSpan}
    \else \def\@tempa{\eqnSpan }\fi
     \@tempa \if@eqnsw\@eqnnum\stepcounter{equation}\fi
     \global\@eqnswtrue\global\@eqcnt\z@\cr}
\def\Eqnarray{\stepcounter{equation}\let\@currentlabel=\theequation
 \if@eqna \let\@currentlabels=\theequations\fi%
  %added for referring an eqn-group 1996/08/04 by S. Fujita (v3.00a)
\w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
\setbox0=\hbox{\@eqnnum}\dimen1=\wd0
\advance\dimen1 by\eqnostretch\arraycolsep
\global\@eqnswtrue\global\@eqcnt\z@\tabskip\z@\let\\=\@eqncr
$$\dimen0=\displaywidth%
\advance\dimen0-\eqleftstretch\leftmargini%
\rightline\bgroup\noindent$%
\vcenter\bgroup\kern\fboxsep
\halign to \dimen0\bgroup\hskip\@centering%\hskip\fboxsep
  $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$
  \hskip\eqnostretch\arraycolsep%
  \dotorspace\hskip\dimen1\tabskip\@centering
  &\llap{##}\tabskip\z@\cr
  \noalign{\global\EQ@cnt=\@eqcnt}%
    %added by SF for version 2.02(1995/10/27)
  \mathstrut&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endEqnarray{\@@eqncr\egroup
  \global\advance\c@equation\m@ne%
  \egroup$\egroup$$\global\@ignoretrue}
\let\@seqncr=\@eqncr
\@namedef{Eqnarray*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\Eqnarray}
\@namedef{endEqnarray*}{\nonumber\endEqnarray\@frameeqnstarfalse}
\let\@seqncr=\@eqncr
\def\eqnarray{\if@eqnflush\Eqnarray\else\eqnArray\fi}
\def\endeqnarray{\if@eqnflush\endEqnarray\else\endeqnArray\fi}
\@namedef{eqnarray*}{\@oldeqswtrue%1995/10/15 for ver2.01
 \def\@eqncr{\nonumber\@seqncr}\eqnarray}
\@namedef{endeqnarray*}{\nonumber\endeqnarray%
 \if@doteqn\@oldeqswfalse\fi}%1995/10/15 for ver2.01
\def\newlabels#1#2{\global\@namedef{rx@#1}{#2}}
\def\refset#1{\@ifundefined{rx@#1}{{\bf ??}\@warning
  {Reference `#1 for eqn-group referring' on page \thepage \space
    undefined}}{\edef\@tempa{\@nameuse{rx@#1}}\expandafter
    \@car\@tempa \@nil\null}}
\newif\if@eqna \@eqnafalse
\def\label#1{\@bsphack
 \if@filesw {%
  \let\thepage\relax
   \def\protect{\noexpand\noexpand\noexpand}%
   \xdef\@gtempa{\write\@auxout{\string
      \newlabel{#1}{{\@currentlabel}{\thepage}}}}%
   \if@eqna%for referring an eqn-group
    \xdef\@gtemps{\write\@auxout{\string
      \newlabels{#1}{{\@currentlabels}{\thepage}}}}%
   \fi%
   }\@gtempa\if@eqna\@gtemps\fi
   \if@nobreak \ifvmode\nobreak\fi\fi%
 \fi\@esphack}
\def\@currentlabels{} % For \label and \refset commands
                      % that come before any environment
\def\theequations{\@ifundefined{chapter}{\theenumi}{%
\ifnakaguro\thechapter\niten\theenumi\else
\thechapter.\theenumi\fi}}% added for version 2.00 by S. Fujita
\def\finpushw@ll{\wd0=0pt \box0}
\def\makepushw@ll#1{\setbox0=\hbox{#1}\finpushw@ll}
\def\mathpushw@ll#1#2{\setbox0=\hbox{$\m@th#1{#2}$}\finpushw@ll}
\def\pushtowall{\relax \leavevmode
 \ifmmode\def\next{\mathpalette\mathpushw@ll}
 \else\let\next\makepushw@ll \fi \next}
\newif\ifnakaguro \nakagurofalse%
 %trueにすると中黒を設定
\newif\ifsubarabic \subarabicfalse%
 %trueにすると細分番号がアラビア数字になる
\newif\ifsubhyphen \subhyphenfalse%
 %trueにすると細分番号が1-aのようになる
\def\niten{\hbox to .5zw{\hfil\raise.5ex\hbox{.}\hfil}}%半角中黒
\def\eqn@rraya{%
 \c@enumi=\c@equation
 \advance\c@enumi by 1
 \global\@eqnatrue%added for referring an equation group (v1.01)
 \c@equation=0
\ifsubarabic
 \@ifundefined{chapter}%
{\def\theequation{\theenumi-\arabic{equation}}}%
{\def\theequation{\ifnakaguro%
\thechapter\niten\theenumi\niten\arabic{equation}%
\else\thechapter.\theenumi-\arabic{equation}\fi}}
\else
\ifsubhyphen
 \@ifundefined{chapter}%
{\def\theequation{\theenumi-\alph{equation}}}%
{\def\theequation{\ifnakaguro%
\thechapter\niten\theenumi-\alph{equation}%
\else\thechapter.\theenumi-\alph{equation}\fi}}
\else
 \@ifundefined{chapter}%
{\def\theequation{\theenumi\alph{equation}}}%
{\def\theequation{\ifnakaguro%
\thechapter\niten\theenumi\alph{equation}%
\else\thechapter.\theenumi\alph{equation}\fi}}
\fi\fi}
\def\nakaguroon{\nakagurotrue
\@ifundefined{chapter}{}{%
\def\theequation{\thechapter\niten\arabic{equation}}}}
\def\eqnarraya{\eqn@rraya \eqnarray}
\def\endeqnarraya{\endeqnarray
\global\c@equation=\c@enumi}
\def\eqnCases{%
 \stepcounter{equation}%
 \let\@currentlabel=\theequation%
 \if@eqna \let\@currentlabels=\theequations\fi%
  %added for referring an eqn-group
 \w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
 \global\@eqnswtrue
 \if@doteqn%
  \setbox0=\hbox{\@eqnnum}\dimen4=\wd0
  \advance\dimen4 by\eqnostretch\arraycolsep
  \else\dimen4=\z@\fi
 \global\@eqcnt\z@\tabskip\@centering\let\\=\@eqncr%
 $$\global\dimen0=\displaywidth%
 \setbox4=\vbox\bgroup\halign to\dimen0\bgroup\hskip\@centering
 \if@doteqn\hskip\eqnostretch\arraycolsep\fi
 \hskip\dimen4\kern\p@renwd
 $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$%
  \if@doteqn\hskip\eqnostretch\arraycolsep\fi
  \dotorspace\hskip\dimen4\tabskip\@centering
  &\llap{##}\tabskip\z@\cr
  \noalign{\global\EQ@cnt=\@eqcnt}%
    %added by SF for version 2.02(1995/10/27)
  \mathstrut&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endeqnCases{\@@eqncr\egroup%
  \global\advance\c@equation\m@ne\egroup
  \setbox2=\vbox{\unvcopy4\global\setbox1\lastbox}%
  \setbox2=\hbox{\unhbox1\lastbox}%
  \dimen1=\dimen0\advance\dimen1 -\wd2\relax%
  \divide\dimen1 by 2\relax\advance\dimen1 -.5\p@renwd%
  \if@doteqn
    \advance\dimen1 \eqnostretch\arraycolsep
    \advance\dimen1 \dimen4
  \fi
  \dimen2=\ht4 \advance\dimen2 by 2\fboxsep%
  \setbox2=\hbox{\pushtowall{\hbox{$\kern\dimen1\left\{%
  \vcenter{\hrule height\dimen2 width 0pt}\right.$}}%
  $\vcenter{\kern\fboxsep\box4\kern\fboxsep}$}%
  \null\hss\hbox{\box2}$$\global\@ignoretrue%
  \global\@eqnafalse%added for referring an eqn-group
}
\let\@seqncr=\@eqncr
\@namedef{eqnCases*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\eqnCases}
\@namedef{endeqnCases*}{\nonumber\endeqnCases\@frameeqnstarfalse}
\def\eqnCasesa#1{\eqn@rraya\eqnCases{#1}}
\def\endeqnCasesa{\endeqnCases\global\c@equation=\c@enumi}
\def\eqnSpec#1{%
 \setbox4=\hbox{$\displaystyle #1$}
 \stepcounter{equation}\let\@currentlabel=\theequation%
 \if@eqna \let\@currentlabels=\theequations\fi%
    %added for referring an eqn-group
 \w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
 \global\@eqnswtrue
 \if@doteqn%
  \setbox0=\hbox{\@eqnnum}\dimen4=\wd0
  \global\advance\dimen4 by\eqnostretch\arraycolsep
  \else\global\dimen4=\z@\fi
 \global\@eqcnt\z@\tabskip\@centering%%%\tabskip0pt
 \let\\=\@eqncr%
 $$\global\dimen0=\displaywidth \advance\dimen0 -\wd4%
 \setbox0=\vbox\bgroup\halign to\dimen0\bgroup
 \hskip\@centering
 \if@doteqn\hskip\eqnostretch\arraycolsep\fi
 \hskip\dimen4\kern\p@renwd
 $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$%
  \if@doteqn\hskip\eqnostretch\arraycolsep\fi
  \dotorspace\hskip\dimen4\tabskip\@centering
  &\llap{##}\tabskip\z@\cr
  \noalign{\global\EQ@cnt=\@eqcnt}%
    %added by SF for version 2.02(1995/10/27)
  \mathstrut&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endeqnSpec{\@@eqncr\egroup%
  \global\advance\c@equation\m@ne\egroup
  \setbox2=\vbox{\unvcopy0\global\setbox1\lastbox}%
  \setbox2=\hbox{\unhbox1\lastbox}%
  \dimen1=\dimen0\advance\dimen1 -\wd2\relax%
  \divide\dimen1 by 2\relax\advance\dimen1 -.5\p@renwd%
  \if@doteqn\advance\dimen1 \eqnostretch\arraycolsep
  \advance\dimen1 \dimen4\fi
 \setbox2=\hbox{$\kern\dimen1\box4%
  \left\{\kern-\dimen1\kern-1.15\p@renwd%
  \vcenter{\kern\fboxsep\box0\kern\fboxsep}\right.$}%
  \null\hss\hbox{\box2}$$\global\@ignoretrue
  \global\@eqnafalse%added for referring an eqn-group
}
\let\@seqncr=\@eqncr
\@namedef{eqnSpec*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\eqnSpec}
\@namedef{endeqnSpec*}{\nonumber\endeqnSpec\@frameeqnstarfalse}
\def\eqnSpeca#1{\eqn@rraya\eqnSpec{#1}}
\def\endeqnSpeca{\endeqnSpec\global\c@equation=\c@enumi}
\def\Eqncases{\stepcounter{equation}\let\@currentlabel=\theequation
\setbox0=\hbox{\@eqnnum}\dimen4=\wd0
\advance\dimen4 by\eqnostretch\arraycolsep
 \if@eqna \let\@currentlabels=\theequations\fi%
    %added for referring an eqn-group
 \w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
 \global\@eqnswtrue\global\@eqcnt\z@\tabskip0pt%%\tabskip\@centering
 \let\\=\@eqncr%
 $$\dimen0=\displaywidth%
 \advance\dimen0-\eqleftstretch\leftmargini%
 \rightline\bgroup\noindent$%
 \left\{\,\vcenter\bgroup\kern\fboxsep
 \halign to \dimen0\bgroup\hskip\@centering%\hskip\fboxsep
  $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$
  \hskip\eqnostretch\arraycolsep%
  \dotorspace\hskip\dimen4\tabskip\@centering
  &\llap{##}\tabskip\z@\cr
  \noalign{\global\EQ@cnt=\@eqcnt}%
    %added by SF for version 2.02(1995/10/27)
  \mathstrut&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endEqncases{\@@eqncr\egroup%
      \global\advance\c@equation\m@ne\kern\fboxsep\egroup\right.$%
      \egroup$$\global\@ignoretrue
  \global\@eqnafalse%added for referring an eqn-group
}
\let\@seqncr=\@eqncr
\@namedef{Eqncases*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\Eqncases}
\@namedef{endEqncases*}{\nonumber\endEqncases\@frameeqnstarfalse}
\def\Eqncasesa#1{\eqn@rraya\Eqncases{#1}}
\def\endEqncasesa{\endEqncases\global\c@equation=\c@enumi}
\def\Eqnspec#1{%
 \setbox4=\hbox{$\displaystyle #1$}%
 \stepcounter{equation}\let\@currentlabel=\theequation
\setbox0=\hbox{\@eqnnum}\dimen4=\wd0
\advance\dimen4 by\eqnostretch\arraycolsep
 \if@eqna \let\@currentlabels=\theequations\fi%
    %added for referring an eqn-group
 \w@dottedlefteqn%added for Version 3.00 by S. Fujita(1996/05/24)
 \global\@eqnswtrue\global\@eqcnt\z@\tabskip0pt%%\tabskip\@centering
 \let\\=\@eqncr$$\dimen0=\displaywidth \dimen3=\displaywidth
 \advance\dimen0-\eqleftstretch\leftmargini \dimen3=\dimen0
 \advance\dimen0 -\wd4 \advance\dimen0 -\p@renwd%
 \advance\dimen0 -0.33333em% 6mu
 \rightline\bgroup\noindent\hbox to\dimen3\bgroup$\vcenter{\box4}\hss%
 \left\{\,\vcenter\bgroup\kern\fboxsep
 \halign to \dimen0\bgroup\hskip\@centering%
  $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$
  \hskip\eqnostretch\arraycolsep%
  \dotorspace\hskip\dimen4\tabskip\@centering
  &\llap{##}\tabskip\z@\cr
  \noalign{\global\EQ@cnt=\@eqcnt}%
     %added by SF for version 2.02(1995/10/27)
  \mathstrut&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endEqnspec{\@@eqncr\egroup
      \global\advance\c@equation\m@ne\kern\fboxsep\egroup\right.$%
      \egroup\egroup$$\global\@ignoretrue
  \global\@eqnafalse%added for referring an eqn-group
}
\let\@seqncr=\@eqncr
\@namedef{Eqnspec*}{\@frameeqnstartrue%
 \def\@eqncr{\nonumber\@seqncr}\Eqnspec}
\@namedef{endEqnspec*}{\nonumber\endEqnspec\@frameeqnstarfalse}
\def\Eqnspeca#1{\eqn@rraya \Eqnspec{#1}}
\def\endEqnspeca{\endEqnspec
\global\c@equation=\c@enumi}
\@ifundefined{eqncases}{%
\typeout{Caution: mathchem.sty should not be incorporated after^^J
mathchm2.sty!}}{%
\typeout{The `eqncases' and `eqnspec' environments of mathchem.sty^^J
have been redefined by mathchm2.sty.}}
\def\eqncases{\if@eqnflush\Eqncases\else\eqnCases\fi}
\def\endeqncases{\if@eqnflush\endEqncases\else\endeqnCases\fi}
\let\@seqncr=\@eqncr
\@namedef{eqncases*}{\def\@eqncr{\nonumber\@seqncr}\eqncases}
\@namedef{endeqncases*}{\nonumber\endeqncases}
\def\eqncasesa{\eqn@rraya\eqncases}
\def\endeqncasesa{\endeqncases
\global\c@equation=\c@enumi}
\def\eqnspec#1{\if@eqnflush\Eqnspec{#1}\else\eqnSpec{#1}\fi}
\def\endeqnspec{\if@eqnflush\endEqnspec\else\endeqnSpec\fi}
\let\@seqncr=\@eqncr
\@namedef{eqnspec*}{\def\@eqncr{\nonumber\@seqncr}\eqnspec}
\@namedef{endeqnspec*}{\nonumber\endeqnspec}
\def\eqnspeca#1{\eqn@rraya\eqnspec{#1}}
\def\endeqnspeca{\endeqnspec
\global\c@equation=\c@enumi}
\def\@EQNcr{{\ifnum0=`}\fi\@ifstar{\global\@eqpen\@M
  \@yEQNcr}{\global\@eqpen\interdisplaylinepenalty \@yEQNcr}}
\def\@yEQNcr{\@ifnextchar [{\@xEQNcr}{\@xEQNcr[\z@]}}
\def\@xEQNcr[#1]{\ifnum0=`{\fi}\@@EQNcr
  \noalign{\penalty\@eqpen\vskip\jot\vskip #1\relax}}
\def\@@EQNcr{\let\@tempa\relax
  \ifcase\@eqcnt%
  \def\@tempa{& & & \eqnSpan}\or \def\@tempa{& & \eqnSpan}
  \else \def\@tempa{& \eqnSpan }\fi
  \@tempa \if@eqnsw\@eqnnum\stepcounter{equation}\fi
  \global\@eqnswtrue\global\@eqcnt\z@\cr}
\newdimen\eqnframesep \eqnframesep=12\p@
\def\eqnFrame{%
 \stepcounter{equation}%
 \let\@currentlabel=\theequation%
 \if@eqna \let\@currentlabels=\theequations\fi%
   %added for referring an eqn-group
 \global\@eqnswtrue
 \w@dottedlefteqn
 \global\@tempdimb=\eqnostretch\arraycolsep
 \if@doteqn%
  \setbox0=\hbox{\@eqnnum}\dimen4=\wd0
  \advance\dimen4 by\@tempdimb\else\dimen4=\z@\fi
 \global\@eqcnt\z@\tabskip\@centering\let\\=\@EQNcr%
 $$\global\dimen0=\displaywidth%
 \setbox4=\vbox\bgroup\halign to\dimen0\bgroup\hskip\@centering
 \if@doteqn\hskip\@tempdimb\hskip\eqnframesep\fi
 \hskip\dimen4%
 $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$%
  \if@doteqn\hskip\eqnframesep\fi
  &\hbox to\@tempdimb{##\hss}
  \dotorspace\hskip\dimen4\tabskip\@centering
  &\llap{##}\tabskip\z@\cr\noalign{\global\EQ@cnt=\@eqcnt}%
  \mathstrut&&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endeqnFrame{\@@EQNcr\egroup
 \global\advance\c@equation\m@ne\egroup
  \setbox2=\vbox{\unvcopy4\global\setbox1\lastbox}%
  \setbox2=\hbox{\unhbox1\lastbox}%
  \dimen2=\wd2 \dimen3=\ht4
  \if@doteqn
   \advance\dimen2-\@tempdimb \advance\dimen2-\@tempdimb
   \advance\dimen2-\dimen4 \advance\dimen2-\dimen4
   \advance\dimen2-\eqnframesep \advance\dimen2-\eqnframesep
  \fi
  \fboxsep=\eqnframesep
  \dimen1=\dimen0 \advance\dimen1-\wd2\relax
  \divide\dimen1 by2\relax \advance\dimen1-\fboxsep%
   \advance\dimen1-\fboxrule
  \if@doteqn \advance\dimen1 \@tempdimb
   \advance\dimen1 \dimen4 \advance\dimen1 \eqnframesep\fi
  \setbox2=\hbox{$\kern\dimen1
   \hbox to\z@{\fbox{$\vcenter to\dimen3{%
    \hbox to\dimen2{\strut\hss}\vss}$}\hss}\kern-\dimen1%
   \vcenter{\kern\fboxsep
    \kern\fboxrule\box4\kern\fboxsep\kern\fboxrule}$}
   \null\hss\hbox{\box2}$$\global\@ignoretrue
  \global\@eqnafalse}%added for referring an eqn-group
\let\@sEQNcr=\@EQNcr
\@namedef{eqnFrame*}{\@frameeqnstartrue%
 \def\@EQNcr{\nonumber\@sEQNcr}\eqnFrame}
\@namedef{endeqnFrame*}{\nonumber\endeqnFrame\@frameeqnstarfalse}
\def\eqnFramea#1{\eqn@rraya\eqnFrame{#1}}
\def\endeqnFramea{\endeqnFrame\global\c@equation=\c@enumi}

\newif\if@lefteqnum \@lefteqnumfalse
\newif\if@frameeqnstar \@frameeqnstarfalse
\def\w@dottedlefteqn{%
 \setbox0=\hbox{\kern\displaywidth\@eqnnum}%
 \ifdim\wd0<.2pt \global\@lefteqnumtrue\fi
 \if@lefteqnum\if@doteqn\if@frameeqnstar\else
 \typeout{Mathchm2 warning: Left equation numbers should not
 be used in a dotted form!}\fi\fi\fi}
\def\Eqnframe{%
 \stepcounter{equation}%
 \let\@currentlabel=\theequation%
 \if@eqna \let\@currentlabels=\theequations\fi%
   %added for referring an eqn-group
 \global\@eqnswtrue
 \w@dottedlefteqn
 \global\@tempdimb=\eqnostretch\arraycolsep
 \if@doteqn \setbox0=\hbox{\@eqnnum}\dimen4=\wd0
  \advance\dimen4 by\@tempdimb\else\dimen4=\z@\fi
 \global\@eqcnt\z@\tabskip\z@%
 \let\\=\@EQNcr%
 $$\global\dimen0=\displaywidth%
 \dimen1=\eqleftstretch\leftmargini
 \if@lefteqnum \global\advance\dimen1 by 20pt\fi
 \advance\dimen0-\dimen1%
 \setbox4=\vbox\bgroup\halign to\dimen0\bgroup\hskip\@centering
 \hskip\eqnframesep
 $\displaystyle\tabskip\z@{##}$\@eqnsel&\global\@eqcnt\@ne
  \hskip \eqrelstretch\arraycolsep \hfil${##}$\hfil
  &\global\@eqcnt\tw@ \hskip \eqrelstretch\arraycolsep
  $\displaystyle\tabskip\z@{##}$%
  \if@doteqn\hskip\eqnframesep\fi
  &\hbox to\@tempdimb{##\hss}\dotorspace\hskip\dimen4
  \tabskip\@centering
  &\llap{##}\tabskip\z@\cr\noalign{\global\EQ@cnt=\@eqcnt}%
  \mathstrut&&&&\cr%
  \noalign{\global\@eqcnt=\EQ@cnt\vskip-\baselineskip}}
\def\endEqnframe{\@@EQNcr\egroup
 \global\advance\c@equation\m@ne\egroup
  \setbox2=\vbox{\unvcopy4\global\setbox1\lastbox}%
   \global\setbox2=\hbox{\unhbox1\lastbox}%
  \dimen2=\wd2 \dimen3=\ht4
  \if@doteqn %%\advance\dimen2-\@tempdimb%
   \advance\dimen2-\dimen4 \advance\dimen2-\eqnframesep\fi
  \advance\dimen2-\eqnframesep \fboxsep=\eqnframesep
  \advance\dimen1-\fboxrule
  \advance\dimen1-\fboxrule
    \advance\dimen1 -\@tempdimb
 \setbox2=\hbox{$\kern\dimen1
   \hbox to\z@{\fbox{$\vcenter to\dimen3{%
    \hbox to\dimen2{\strut\hss}\vss}$}\hss}\kern-\dimen1%
\rightline{$%
\vcenter{\kern\fboxsep
    \kern\fboxrule\box4\kern\fboxsep\kern\fboxrule}$}$}
   \null\hss\hbox{\box2}$$\global\@ignoretrue
  \global\@eqnafalse}%added for referring an eqn-group
\let\@sEQNcr=\@EQNcr
\@namedef{Eqnframe*}{\@frameeqnstartrue%
 \def\@EQNcr{\nonumber\@sEQNcr}\Eqnframe}
\@namedef{endEqnframe*}%
 {\nonumber\endEqnframe\@frameeqnstarfalse}
\def\Eqnframea#1{\eqn@rraya\Eqnframe{#1}}
\def\endEqnframea{\endEqnframe\global\c@equation=\c@enumi}
\def\eqnframe{\if@eqnflush\Eqnframe\else\eqnFrame\fi}
\def\endeqnframe{\if@eqnflush\endEqnframe\else\endeqnFrame\fi}
\let\@sEQNcr=\@EQNcr
\@namedef{eqnframe*}{\@frameeqnstartrue%
 \def\@EQNcr{\nonumber\@sEQNcr}\eqnframe}
\@namedef{endeqnframe*}%
 {\nonumber\endeqnframe\@frameeqnstarfalse}
\def\eqnframea#1{\eqn@rraya\eqnframe{#1}}
\def\endeqnframea{\endeqnframe\global\c@equation=\c@enumi}
\endinput
%% 
%% End of file `mathchm2.sty'.

%$% subfigure.sty
%$% Subfigure/table command for use with the LaTeX figure environment.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Copyright (C) 1988-1995 Steven Douglas Cochran.
%%%
%%% The subfigure style is made available for academic and research
%%% purposes only.  No commercial license is hereby granted.  Copying
%%% and other reproduction is authorized only for research, education,
%%% and other non-commercial purposes.  No warranties, either
%%% expressed or impiled, are made regarding the operation, use, or
%%% results of the subfigure style.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% @LaTeX-style-file{
%%%    Author              = "Steven Douglas Cochran",
%%%    Version             = "2.0 (LaTeX209 version)",
%%%    Date                = "1995 Mar 06",
%%%    Time                = "12:43:14 EDT",
%%%    Filename            = "subfigure.sty",
%%%    Address             = "Digital Mapping Laboratory
%%%                           School of Computer Science
%%%                           Carnegie-Mellon University
%%%                           5000 Forbes Avenue
%%%                           Pittsburgh, PA 15213-3891
%%%                           USA",
%%%    Telephone           = "(412) 268-5654",
%%%    FAX                 = "(412) 268-5576",
%%%    checksum            = "23098 438 1899 18286",
%%%    Email               = "sdc+@CS.CMU.EDU (Internet)",
%%%    CodeTable           = "ISO/ASCII",
%%%    Keywords            = "LaTeX, float, figure, table",
%%%    Supported           = "yes",
%%%    Abstract            = "LaTeX document-style option for
%%%                           providing support for the inclusion of
%%%                           small `sub' figures and tables.  It
%%%                           simplifies the positioning, captioning
%%%                           and labeling of them within a single
%%%                           figure or table environment.",
%%%    DocString           = "The checksum field above contains a CRC-16
%%%                           checksum as the first value, followed by
%%%                           the equivalent of the standard UNIX wc
%%%                           (word count) utility output of lines,
%%%                           words, and characters.  This is produced
%%%                           by Robert Solovay's checksum utility."
%%% }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% $Log:       subfigure.sty,v $
%$%  Revision 2.0  95/03/06  12:43:14  sdc
%$%  This version of `subfigure' is the first to be ported to LaTeX2e
%$%  (with backward compatibility to LaTeX 2.09).  "\subfigure" and
%$%  "\subtable" are now identical and the environment controls
%$%  internal differences between them.  Now, the caption setting
%$%  portion of "\@subfloat" is broken into the separate macros
%$%  "\@makesubfigurecaption" and "\@makesubtablecaption" to allow a
%$%  separate hook for the modification of how the caption is
%$%  constructed and to allow the table and figure captions to be
%$%  different.  In addition, support of the `normal', `hang',
%$%  `center', `centerlast', 'nooneline'; `scriptsize', \ldots,
%$%  `Large'; `up', `it', `sl', `sc', `md', `bf', `rm', `sf', and `tt'
%$%  package options were added for compatibility with the caption.sty
%$%  by H.A. Sommerfeldt.}  
%$%  
%$%  Revision 1.6  93/05/13  12:58:34  sdc
%$%  Changed to use the \thefigure macro in building the referenced
%$%  label.  The old form caused a problem when used with the
%$%  report.sty as pointed out by Andrew Anselmo
%$%  (anselmo@cumesb.mech.columbia.edu).  Also modified to restrict
%$%  the scope of the subfigure \label to the body of the subfigure.
%$%  Added \@thesubfigure to allow a separate labeling of the
%$%  subfigure in the figure and in the text.  By default it is the
%$%  same as \thesubfigure with space appended.  Added some hooks to
%$%  print the subfigure captions to the list-of-figures file if
%$%  desired.  Finally, added the corresponding support for sub-tables
%$%  as well as sub-figures.  NOTE: the optional caption is now a
%$%  moving argument and any fragile commands that appear in the
%$%  caption must be preceded by a \protect (just like that of the
%$%  \caption command).
%$%   
%$%  Revision 1.5  92/08/11  23:13:12  sdc
%$%  Fixed a bug which caused an problem with captions that contained  
%$%  expressions like \sqrt;  This was pointed out by Tom Scavo
%$%  (scavo@cie.uoregon.edu).  A separate bug was fixed which caused
%$%  different sized captions to be misaligned;  This problem was
%$%  pointed out by Simon Marshall (S.Marshal@Hull.ac.uk).  Also
%$%  cleaned up the code a mite and *changed* the figure spacing so that
%$%  if no optional section is given, then the figure is only followed
%$%  by \subfigbottomskip and not that plus (\subfigcapskip + \strut
%$%  height).  This should make it easier to adjust spacing as desired.
%$%   
%$%  Revision 1.4  92/06/27  10:40:34  sdc
%$%  Added a hack to allow the \label command to be used within the
%$%  body of the subfigure giving a reference label in the form
%$%  \arabic{thefigure}\thesubfigure.  Added standard file header for
%$%  style.  
%$%   
%$%  Revision 1.3  90/10/22  17:04:28  cochran
%$%  Changed test for empty caption inside of \@subfigure to compare
%$%  tokens and not the caption vs. \@empty.  The former (incorrect)
%$%  test caused an error when the first two letters of the caption
%$%  were the same.
%$%
%$%  Revision 1.2  89/08/30  07:18:29  cochran
%$%  Added a separate bottom margin and expanded the comments.
%$%
%$%  Revision 1.1  88/11/02  11:03:46  cochran
%$%  Initial revision.
%$%
%$%  05 Mar 86  cochran@dworkin.usc.edu (USC-IRIS)
%$%  Created.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%$% Usage:  \documentstyle[...,subfigure,...]{...}
%$%
%$%             \subfigure[CAPTIONtext]{FIGUREbox}
%%%
%%% Creates a subfigure box with an optional CAPTION under a FIGURE.
%%% The FIGURE is centered with \subfigtopskip of vertical space added
%%% above.  If there is a CAPTION, then \subfigcapskip vertical space
%%% is added below the FIGURE followed by the CAPTION.  Finally,
%%% \subfigbottomskip of vertical space added at the bottom.  
%%%
%%% If a CAPTION is given (including a null CAPTION `[]') then the
%%% subfigure is labeled with a counter formatted by the macro
%%% `\thesubfigure' which returns `(a)', `(b)', etc.  If desired,
%%% this macro may be redefined.  The counter used for labeling the
%%% subfigures is `subfigure' and is incremented for each subfigure
%%% regardless of whether a CAPTION was printed.
%%%
%$%             \subfigure[CAPTIONtext]{FIGUREbox}
%%%
%%% The subtable command is symmetric to the subfigure command defined
%%% above.   
%%%
%%% One example of use is to surround the figure in a center
%%% environment or to specifying \centering:
%%%
%%%                                          *---------*   
%%%   \newcommand{\goodgap}{%                |  ..   . |   *---------*  
%%%     \hspace{\subfigtopskip}%             |  .   .  |   | . .  .  |  
%%%     \hspace{\subfigbottomskip}}          | .. . .  |   | .  . .. |  
%%%   ...                                    *---------*   *---------*    
%%%   \begin{figure}%                         (a) First     (b) Second   
%%%     \centering                                          Figure 
%%%     \subfigure[First]{...}\goodgap      
%%%     \subfigure[Second Figure]{...}\\           *---------*
%%%     \subfigure[Third]{\label{3figs-c}...}%     | . .. .  |
%%%     \caption{Three Subfigures.}                | . .. .  |
%%%     \label{3figs}                              *---------*
%%%   \end{figure}                                  (c) Third
%%%   ...                                   Figure 1. Three Subfigures.    
%%%   Figure~\ref{3figs} contains        
%%%   two top `subfigures' and           Figure 1 contains two top `sub-
%%%   Figure~\ref{3figs-c}.              figures' and Figure 1(c).
%%%
%%% A second example is to change the way that the subfigures are labeled
%%% and to have the subfigure captions printed in the list-of-figures.
%%%
%%%   \renewcommand{\thesubfigure}{\thefigure.\arabic{subfigure}}
%%%   \makeatletter
%%%     \renewcommand{\@thesubfigure}{\thesubfigure:\space}
%%%     \renewcommand{p@subfigure}{}
%%%   \makeatother
%%%   ...
%%%   \setcounter{lofdepth}{2}
%%%   \listoffigures
%%%   ...
%%%   \begin{figure}%
%%%     \begin{center}%
%%%       \subfigure[First]{%         *--------------*  *--------------*   
%%%         \label{fig:first}%        |  ..   .  .   |  | . ... .. . . |  
%%%         ...}%                     |  .  .   .  . |  | .  .  . . .. |  
%%%       \goodgap                    | .. . .  . .  |  | . . . .. ..  |
%%%      \subfigure[Second]{%         *--------------*  *--------------*   
%%%         \label{fig:second}%  
%%%         ...}%                        1.1: First        1.2: Second
%%%     \end{center}%
%%%     \caption{Two Subfigures.}          Figure 1. Two Subfigures.
%%%   \end{figure}                   
%%%   ...                             See subfigures 1.1 and 1.2.  
%%%   See subfigures \ref{fig:first}  
%%%   and \ref{fig:second}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Options:
%%%
%%%  I. Subfloat caption shape.
%%%     By default the caption paragraphs are centered under the
%%%     subfigure or table with a little indentation at each side.
%%%     There are three options that may be used to change the shape
%%%     of the centered paragraph -- they only have an effect when the
%%%     caption is more than one line long.  These should be set in
%%%     the preamble of your LaTeX file:
%%%     
%%%          \subcaphangtrue        Causes the label to be a hanging
%%%                                 indentation to the caption paragraph.
%%%          \subcapcentertrue      Causes each line of the paragraph
%%%                                 to be separately centered.
%%%          \subcapcenterlasttrue  Causes the last line only to be 
%%%                                 centered.
%%%          \subcapnooneline       If a caption fits on one line it
%%%                                 will, by default, be centered.
%%%                                 This option left-justifies the one
%%%                                 line caption.
%%%
%%%     The hang option may be used in addition to either center
%%%     option.  (If both center options are true it is the same as if
%%%     only the \subcapcenter was true.)
%%%     
%%%     
%%% II. Subfloat label font.
%%%     The subfloat label font may be separately set by changing the
%%%     definition of \subcaplabelfont.  For example:
%%%     
%%%          \newcommand{\subcaplabelfont}{\it}
%%%     
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%
%%%  Identification
%%%
\ifx\if@compatibility\undefined\else
  \NeedsTeXFormat{LaTeX2e}
  \ProvidesPackage{subfigure}[1995/03/06 v2.0 subfigure package]
  \typeout{Package: subfigure 1995/03/06 v2.0}
\fi

%%%
%%%  Initialization and Shared constants
%%%
\newif\ifsubcaphang
\newif\ifsubcapcenter
\newif\ifsubcapcenterlast
\newif\ifsubcapnooneline

%%
%% Common values (mention of `subfig' in names is for upward compatibility)
%%

%%Modified (2004/12/20)
\newcommand{\subfigtopskip}{0pt}    % Length from the top of the subfloat
                                     %   box to the begining of the FIGURE box.
\newcommand{\subfigbottomskip}{10pt} % Length from the bottom of the CAPTION
                                     %   to the bottom of the subfloat.
\newcommand{\subfigcapskip}{-2mm}    % Length from the bottom of the FIGURE box
                                     %   to the begining of the CAPTION.
\newcommand{\subfigcapmargin}{10pt}  % Indentation of the caption from the
                                     %   sides of the subfloat box (This should
                                     %   always be positive).
\newcommand{\subcapsize}{\scriptsize}           % Size of the CAPTION font.
\newcommand{\subcaplabelfont}{}      % Font of the caption label.

%%
%% Subfigure values
%%
\newcounter{subfigure}[figure]          % Subfigure counter.
\def\thesubfigure{(\alph{subfigure})}   % Generate CAPTION label (text).
\newcommand{\@thesubfigure}{%           % Generate CAPTION label (figure).
  {\subcaplabelfont\thesubfigure}\space}
\let\p@subfigure\thefigure              % Figure number for \label.

\let\ext@subfigure\ext@figure           % Default SubFigure file extension.
\newcommand{\l@subfigure}{%             % How to print an LOF subfigure line.
  \@dottedxxxline{\ext@subfigure}{2}{3.9em}{2.3em}}
\newcounter{lofdepth}                   % LOF depth counter.
\setcounter{lofdepth}{1}                % Default is to NOT print an LOF line.

%%
%% Subtable values
%%
\newcounter{subtable}[table]            % Subtable counter.
\def\thesubtable{(\alph{subtable})}     % Generate CAPTION label (text).
\newcommand{\@thesubtable}{%            % Generate CAPTION label (figure).
  {\subcaplabelfont\thesubtable}\space}
\let\p@subtable\thetable                % Figure number for \label.

\let\ext@subtable\ext@table             % Default SubTable file extension.
\newcommand{\l@subtable}{%              % How to print an LOT subtable line.
  \@dottedxxxline{\ext@subtable}{2}{3.9em}{2.3em}}
\newcounter{lotdepth}                   % LOT depth counter.
\setcounter{lotdepth}{1}                % Default is to NOT print an LOT line.


%%
%% Declaration of options
%%
\ifx\if@compatibility\undefined
  \subcaphangfalse
  \subcapcenterfalse
  \subcapcenterlastfalse
  \subcapnoonelinefalse
  \def\subcapsize{\footnotesize}
\else
  \DeclareOption{normal}{%
    \subcaphangfalse
    \subcapcenterfalse
    \subcapcenterlastfalse}
  \DeclareOption{hang}{\subcaphangtrue}
  \DeclareOption{center}{\subcapcentertrue}
  \DeclareOption{centerlast}{\subcapcenterlasttrue}
  \DeclareOption{nooneline}{\subcapnoonelinetrue}
  \DeclareOption{isu}{\ExecuteOption{hang}}
  \DeclareOption{anne}{\ExecuteOption{centerlast}}

  \DeclareOption{scriptsize}{\renewcommand{\subcapsize}{\scriptsize}}
  \DeclareOption{footnotesize}{\renewcommand{\subcapsize}{\footnotesize}}
  \DeclareOption{small}{\renewcommand{\subcapsize}{\small}}
  \DeclareOption{normalsize}{\renewcommand{\subcapsize}{\normalsize}}
  \DeclareOption{large}{\renewcommand{\subcapsize}{\large}}
  \DeclareOption{Large}{\renewcommand{\subcapsize}{\Large}}
  \DeclareOption{up}{\renewcommand{\subcaplabelfont}{\upshape}}
  \DeclareOption{it}{\renewcommand{\subcaplabelfont}{\itshape}}
  \DeclareOption{sl}{\renewcommand{\subcaplabelfont}{\slshape}}
  \DeclareOption{sc}{\renewcommand{\subcaplabelfont}{\scshape}}
  \DeclareOption{md}{\renewcommand{\subcaplabelfont}{\mdseries}}
  \DeclareOption{bf}{\renewcommand{\subcaplabelfont}{\bfseries}}
  \DeclareOption{rm}{\renewcommand{\subcaplabelfont}{\rmfamily}}
  \DeclareOption{sf}{\renewcommand{\subcaplabelfont}{\sffamily}}
  \DeclareOption{tt}{\renewcommand{\subcaplabelfont}{\ttfamily}}

  \ExecuteOptions{normal,footnotesize}
  \ProcessOptions
\fi


%%%
%%% Define the subfigure and subtable commands
%%%
\newcommand{\subfigure}{%
  \bgroup
    % Since the table caption is usually generated later, we
    % must locally anticipate the future value of its counter.  
    \advance\csname c@\@captype\endcsname\@ne
    \refstepcounter{sub\@captype}%
    \leavevmode
    \@ifnextchar [%
      {\@subfloat{sub\@captype}}%
      {\@subfloat{sub\@captype}[\@empty]}}
\let\subtable\subfigure

%%%
%%% Define the common subfloat macro
%%%
\def\@subfloat#1[#2]#3{%
    \setbox\@tempboxa \hbox{#3}%
    \@tempdima=\wd\@tempboxa
    \vtop{%
      %% Put the top spacing and the figure in the top box
      \vbox{%
        \vskip\subfigtopskip
        \box\@tempboxa}%
      %% Now skip down and add the caption paragraph
      %%   (unless #2 == \@empty)
      \ifx \@empty#2\relax \else
        \vskip\subfigcapskip
        \@subcaption{#1}{#2}%
      \fi
      %% Finally add the bottom spacing.
      \vskip\subfigbottomskip}%
  \egroup}

\newcommand{\@subfigcaptionlist}{}

\newcommand{\@subcaption}[2]{%
  \begingroup
    \let\label\@gobble
    \def\protect{\string\string\string}%
    \xdef\@subfigcaptionlist{%
      \@subfigcaptionlist,%
      {\protect\numberline {\@currentlabel}%
       \noexpand{\ignorespaces #2}}}%
  \endgroup
  \@nameuse{@make#1caption}{\@nameuse{@the#1}}{#2}}

\newcommand{\@makesubfigurecaption}[2]{%
  \setbox\@tempboxa \hbox{%
    \subcapsize
    \ignorespaces #1%
    \ignorespaces #2}%
  \@tempdimb=-\subfigcapmargin
  \multiply\@tempdimb\tw@
  \advance\@tempdimb\@tempdima
    \hbox to\@tempdima{%
      \hfil
      \ifdim \wd\@tempboxa >\@tempdimb
        \subfig@caption{#1}{#2}%
      \else\ifsubcapnooneline
        \subfig@caption{#1}{#2}%
      \else 
        \box\@tempboxa
      \fi\fi
      \hfil}}

\let\@makesubtablecaption\@makesubfigurecaption

\newcommand{\subfig@caption}[2]{%
  \ifsubcaphang
    \sbox{\@tempboxa}{%
      \subcapsize
      \ignorespaces #1}%
    \addtolength{\@tempdimb}{-\wd\@tempboxa}%
    \usebox{\@tempboxa}%
    \subfig@captionpar{\@tempdimb}{#2}%
  \else
    \subfig@captionpar{\@tempdimb}{#1#2}%
  \fi}

\newcommand{\subfig@captionpar}[2]{%
  \parbox[t]{#1}{%
    \strut
    \ifsubcapcenter
      \setlength{\leftskip}{\@flushglue}%
      \setlength{\rightskip}{\@flushglue}%
      \setlength{\parfillskip}{\z@skip}%
    \else\ifsubcapcenterlast
      \addtolength{\leftskip}{0pt plus 1fil}%
      \addtolength{\rightskip}{0pt plus -1fil}%
      \setlength{\parfillskip}{0pt plus 2fil}%
    \fi\fi
    \subcapsize
    \ignorespaces #2}}

%%%
%%% Generalized wrapper for the \@dottedtocline macro.  This checks for
%%% the level based on the output file (#1) and not using only
%%% \@tocdepth.  
%%%
\newcommand{\@dottedxxxline}[6]{%
  \ifnum #2>\@nameuse{c@#1depth}\else
    \@dottedtocline{0}{#3}{#4}{#5}{#6}
  \fi}

%%%
%%% Finally, wrap the \@caption macro to dump any sub-captions saved
%%% after calling the standard \@caption.
%%%
\let\subfig@oldcaption\@caption

\long\def\@caption#1[#2]#3{%
  \subfig@oldcaption{#1}[{#2}]{#3}%
  \@for \@tempa:=\@subfigcaptionlist \do {%
    \ifx\@empty\@tempa\relax \else
      \addcontentsline
        {\@nameuse{ext@sub#1}}%
        {sub#1}%
        {\@tempa}%
    \fi}%
  \gdef\@subfigcaptionlist{}}
\endinput

%%% 
%%% End of file `subfigure.sty'.

